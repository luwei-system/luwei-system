<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LUWEI ROOM — 루웨이의 방</title>
    <meta name="description" content="이곳은 루웨이의 시간과 감정이 머무는 방입니다. 감정의 잔상, 파동의 흔적, 하루의 일기가 조용히 전시되는 디지털 아틀리에.">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#CFE8FF">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="./assets/Circle_logo.svg">
    <link rel="icon" type="image/png" href="./assets/favicon.png">
    <link rel="apple-touch-icon" href="./assets/favicon.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@200;300;400;500&family=Cormorant+Garamond:wght@300;400;500&family=Playfair+Display:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- LUWEI Base CSS -->
    <link rel="stylesheet" href="./css/base.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }
        
        html {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            height: 100%;
        }
        
        body {
            font-family: 'Noto Sans KR', 'Cormorant Garamond', serif;
            background: url('./assets/home.jpg');
            background-size: 100% 100%;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            color: #111111;
            min-height: 100vh;
            height: auto;
            overflow-x: hidden;
            overflow-y: scroll;
            -webkit-overflow-scrolling: touch;
            opacity: 0;
            transition: opacity 1s ease;
            position: relative;
            animation: breatheBackground 8s ease-in-out infinite;
            font-weight: 300;
        }
        
        body.loaded {
            opacity: 1;
        }
        
        @keyframes breatheBackground {
            0%, 100% {
                background-size: 105% 105%;
            }
            50% {
                background-size: 100% 100%;
            }
        }
        
        .home-entrance {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('./assets/home.jpg');
            background-size: 100% 100%;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease, visibility 1s ease;
            pointer-events: auto;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            padding: 20px 0;
        }
        
        .home-entrance.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        
        .main-headline {
            text-align: center;
            padding: 40px 20px 20px 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .headline-title {
            font-family: 'Noto Sans KR', 'Cormorant Garamond', serif;
            font-size: 36px;
            font-weight: 300;
            color: rgba(255, 255, 255, 1);
            margin-bottom: 15px;
            letter-spacing: 3px;
            line-height: 1.6;
            text-shadow: 0 3px 30px rgba(0, 0, 0, 0.8), 0 1px 10px rgba(0, 0, 0, 0.6);
            white-space: normal;
            word-wrap: break-word;
            word-break: keep-all;
            overflow-wrap: break-word;
            padding: 0 20px;
        }
        
        .headline-subtitle {
            font-family: 'Noto Sans KR', 'Playfair Display', serif;
            font-size: 16px;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.95);
            letter-spacing: 8px;
            text-transform: uppercase;
            font-style: italic;
            text-shadow: 0 2px 20px rgba(0, 0, 0, 0.7);
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
            padding: 0 20px;
        }
        
        .headline-description {
            font-family: 'Noto Sans KR', 'Cormorant Garamond', serif;
            font-size: 14px;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.95);
            margin-top: 20px;
            line-height: 1.8;
            letter-spacing: 1px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            text-shadow: 0 2px 20px rgba(0, 0, 0, 0.7);
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            white-space: normal;
            word-wrap: break-word;
            word-break: keep-all;
            overflow-wrap: break-word;
        }
        
        .layers-container {
            position: relative;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUpCard 2s ease-out 0.5s forwards;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            max-width: 900px;
            width: 90%;
            margin: 40px auto;
            z-index: 9999;
        }
        
        @keyframes fadeInUpCard {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .layer-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            border: none;
            border-radius: 16px;
            padding: 24px;
            text-align: left;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            display: block;
            color: inherit;
            position: relative;
            min-height: 280px;
            max-height: 280px;
            overflow: hidden;
            aspect-ratio: 1;
            outline: none;
        }
        
        .layer-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
        }
        
        .room-bg-card {
            background-image: url('./assets/door.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: hidden;
            border-radius: 20px;
        }
        
        .app-card-with-bg {
            background-image: url('./assets/soon.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: visible;
        }
        
        .layer-header {
            position: relative;
            z-index: 3;
            margin-bottom: 16px;
        }
        
        .layer-title {
            font-family: 'Noto Sans KR', 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 300;
            text-transform: uppercase;
            letter-spacing: 4px;
            font-style: italic;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
            display: inline-block;
        }
        
        .layer-title:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.05);
        }
        
        .layer-title:active {
            transform: scale(0.95);
        }
        
        .lang-kr {
            display: block;
        }
        
        .lang-en {
            display: none;
        }
        
        body.lang-english .lang-kr {
            display: none;
        }
        
        body.lang-english .lang-en {
            display: block;
        }
        
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: transparent;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .language-switcher {
            cursor: pointer;
            width: 50px;
            height: 40px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 14px;
            color: white;
            font-weight: 500;
        }
        
        .language-switcher:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .home-button {
            position: fixed;
            top: 10px;
            left: 10px;
            width: 50px;
            height: 50px;
            z-index: 10000;
            cursor: pointer;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease;
        }
        
        .home-button:hover {
            transform: scale(1.1);
        }
        
        .music-toggle-index {
            position: fixed;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 3px solid rgba(255, 255, 255, 0.8);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            transition: all 0.3s ease;
            animation: floatAround 60s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }
        
        @keyframes floatAround {
            0% {
                top: 10%;
                left: 15%;
            }
            12.5% {
                top: 5%;
                left: 50%;
            }
            25% {
                top: 15%;
                left: 85%;
            }
            37.5% {
                top: 50%;
                left: 90%;
            }
            50% {
                top: 85%;
                left: 70%;
            }
            62.5% {
                top: 95%;
                left: 30%;
            }
            75% {
                top: 70%;
                left: 5%;
            }
            87.5% {
                top: 50%;
                left: 15%;
            }
            100% {
                top: 10%;
                left: 15%;
            }
        }
        
        .music-toggle-index img {
            width: 60px;
            height: 60px;
            object-fit: contain;
            pointer-events: none;
        }
        
        @media (max-width: 768px) {
            .layers-container {
                grid-template-columns: 1fr;
                gap: 12px;
                margin: 80px auto 120px auto;
                padding-bottom: 60px;
            }
            
            .layer-card {
                min-height: 200px;
                max-height: 200px;
                padding: 16px;
            }
            
            .headline-title {
                font-size: 24px;
                letter-spacing: 1px;
            }
            
            .layer-title {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Background Music -->
    <audio id="indexBackgroundMusic" loop autoplay muted>
        <source src="./assets/music/Weightless Mist.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Home Entrance -->
    <div class="home-entrance">
        <!-- Main Headline -->
        <div class="main-headline">
            <h1 class="headline-title">
                <span class="lang-kr">당신의 중심으로 돌아가는 세계</span>
                <span class="lang-en">Return to Your Center</span>
            </h1>
            <p class="headline-subtitle">
                <span class="lang-kr">LUWEI SYSTEM</span>
                <span class="lang-en">LUWEI SYSTEM</span>
            </p>
            <p class="headline-description">
                <span class="lang-kr">당신이 가진 어떤 도구로든 시작할 수 있습니다.</span>
                <span class="lang-en">You can start with any tool you have.</span>
            </p>
        </div>
        
        <div class="layers-container">
            <!-- WEB Card with Door Button -->
            <div class="layer-card room-bg-card">
                <div class="layer-header">
                    <div class="layer-title">WEB</div>
                </div>
            </div>
            
            <div class="layer-card app-card-with-bg">
                <div class="layer-header">
                    <div class="layer-title">
                        <span class="lang-kr">앱</span>
                        <span class="lang-en">APP</span>
                    </div>
                </div>
            </div>
            
            <!-- Books Card -->
            <div class="layer-card" style="background-image: url('./assets/책.png'); background-size: 150%; background-position: center; background-repeat: no-repeat;">
                <div class="layer-header" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 3; display: flex; flex-direction: column; gap: 10px; align-items: center;">
                    <div class="layer-title" onclick="window.open('https://product.kyobobook.co.kr/detail/S000217121886', '_blank', 'noopener,noreferrer'); event.stopPropagation();"><span class="lang-kr">교보문고</span><span class="lang-en">Kyobo</span></div>
                    <div class="layer-title" onclick="window.open('https://www.yes24.com/product/goods/147732376', '_blank', 'noopener,noreferrer'); event.stopPropagation();"><span class="lang-kr">YES24</span><span class="lang-en">YES24</span></div>
                    <div class="layer-title" onclick="window.open('https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=367266664', '_blank', 'noopener,noreferrer'); event.stopPropagation();"><span class="lang-kr">알라딘</span><span class="lang-en">Aladin</span></div>
                    </div>
            </div>
        </div>
    </div>
    
    <!-- Home Button -->
    <div class="home-button" onclick="location.reload()">
        <img src="./assets/home.jpg" alt="Home" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
    </div>
    
    <!-- Footer with Language Switcher -->
    <footer class="footer">
        <div class="language-switcher" id="langSwitcher">
            <span class="lang-kr">한</span>
            <span class="lang-en">EN</span>
        </div>
    </footer>

    <!-- Music Toggle Button -->
    <div class="music-toggle-index" id="musicToggleIndex" onclick="toggleMusicIndex()">
        <img src="./assets/음악아이콘.png" alt="Music" id="musicIconIndex">
    </div>
    
    <script>
        // Home entrance experience
        function toggleLanguage() {
            document.body.classList.toggle('lang-english');
        }
        
        window.addEventListener('load', function() {
            // Language switcher event
            const langSwitcher = document.getElementById('langSwitcher');
            if (langSwitcher) {
                langSwitcher.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleLanguage();
                });
            }
            // Add loaded class to body
            setTimeout(function() {
                document.body.classList.add('loaded');
            }, 100);
            
            const webCard = document.querySelector('.room-bg-card');
            if (webCard) {
                webCard.addEventListener('click', function() {
                    window.location.href = 'entrance.html';
                });
                webCard.style.cursor = 'pointer';
            }
        });
        
        // Music toggle for index page
        let isMusicPlayingIndex = true;
        let indexMusic;
        
        function toggleMusicIndex() {
            if (!indexMusic) {
                indexMusic = document.getElementById('indexBackgroundMusic');
            }
            
            const button = document.getElementById('musicToggleIndex');
            
            if (isMusicPlayingIndex) {
                indexMusic.pause();
                isMusicPlayingIndex = false;
                if (button) {
                    button.style.opacity = '0.7';
                }
            } else {
                indexMusic.play().catch(e => console.log('Could not play music:', e));
                isMusicPlayingIndex = true;
                if (button) {
                    button.style.opacity = '0.2';
                }
            }
        }
        
        // Initialize music on page load
        window.addEventListener('load', function() {
            indexMusic = document.getElementById('indexBackgroundMusic');
            const button = document.getElementById('musicToggleIndex');
            if (button) {
                button.style.opacity = '0.2'; // Music is playing initially
            }
            
            setTimeout(function() {
                if (indexMusic) {
                    indexMusic.muted = false;
                    indexMusic.play().catch(e => console.log('Could not play music:', e));
                    indexMusic.addEventListener('pause', function() {
                        isMusicPlayingIndex = false;
                        if (button) {
                            button.style.opacity = '0.7';
                        }
                    });
                    indexMusic.addEventListener('play', function() {
                        isMusicPlayingIndex = true;
                        if (button) {
                            button.style.opacity = '0.2';
                        }
                    });
                }
            }, 500);
        });
        
        document.addEventListener('click', function() {
            if (indexMusic && indexMusic.muted) {
                indexMusic.muted = false;
                indexMusic.play().catch(e => console.log('Could not play music:', e));
                const button = document.getElementById('musicToggleIndex');
                if (button) {
                    isMusicPlayingIndex = true;
                    button.style.opacity = '0.2';
                }
            }
        }, { once: true });
    </script>
    
    <!-- LUWEI Phase 1 Scripts -->
    <script src="./js/luwei-sync.js"></script>
    <script src="./js/luwei-supabase.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
    <script>
        window.__LUWEI_SUPABASE_CONFIG = {
            url: 'https://ngyjzclndgffwzhoukuj.supabase.co',
            anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5neWp6Y2xuZGdmZnd6aG91a3VqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2Mzc3MDksImV4cCI6MjA3NzIxMzcwOX0.z2HvEUaVjiJ2HhfC8Qxf1Ka0Acpc3DtW4IM8dLYV_o0',
            functionsUrl: 'https://ngyjzclndgffwzhoukuj.supabase.co/functions/v1'
        };
    </script>
    <script src="./js/luwei-auth.js?v=3"></script>
    <script>
        (function(){
          const box = document.createElement('div');
          box.style.cssText = 'position:fixed;right:10px;bottom:10px;background:rgba(255,255,255,.9);backdrop-filter:blur(8px);border:1px solid rgba(0,0,0,.08);border-radius:12px;padding:10px;z-index:2147480000;box-shadow:0 2px 16px rgba(0,0,0,.1);font-family:\'Noto Sans KR\'';
          box.innerHTML = `
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
              <span id="auth_status" style="font-size:12px;color:#333;background:rgba(207,232,255,.6);border:1px solid rgba(0,0,0,.08);padding:4px 8px;border-radius:999px;display:none">로그인됨</span>
              <button id="auth_apple" class="btn" style="height:36px;padding:0 12px">Apple로 시작</button>
              <button id="auth_kakao" class="btn" style="height:36px;padding:0 12px">카카오로 시작</button>
              <button id="auth_google" class="btn" style="height:36px;padding:0 12px;display:none !important">Google로 시작</button>
              <button id="auth_instagram" class="btn" style="height:36px;padding:0 12px;display:none !important">Instagram로 시작</button>
              <button id="auth_out" class="btn" style="height:36px;padding:0 12px;display:none">로그아웃</button>
            </div>`;
          document.body.appendChild(box);
          const outBtn = box.querySelector('#auth_out');
          const statusEl = box.querySelector('#auth_status');
          const loginBtns = ['#auth_apple','#auth_google','#auth_kakao','#auth_instagram']
            .map(sel => box.querySelector(sel))
            .filter(Boolean);
          const updateAuthUI = async ()=>{
            let sess = null;
            
            // 1. Check localStorage first (fastest)
            try {
              const stored = localStorage.getItem('luwei_auth');
              if (stored) {
                sess = JSON.parse(stored);
              }
            } catch(e) {
              console.warn('[auth-ui] localStorage parse error', e);
            }
            
            // 2. If luweiAuth API available, use it
            if (!sess && window.luweiAuth && window.luweiAuth.getSession) {
              sess = window.luweiAuth.getSession();
            }
            
            const isOn = !!sess;
            console.log('[auth-ui] session check', { isOn, hasSession: !!sess, userId: sess?.user?.id });
            
          // Update UI
          outBtn.style.display = isOn ? 'inline-block' : 'none';
          statusEl.style.display = isOn ? 'inline-block' : 'none';
          
          // Show only Apple and Kakao when not logged in
          const appleBtn = box.querySelector('#auth_apple');
          const kakaoBtn = box.querySelector('#auth_kakao');
          
          if (isOn) {
            // Hide login buttons when logged in
            if (appleBtn) appleBtn.style.display = 'none';
            if (kakaoBtn) kakaoBtn.style.display = 'none';
            
            // Show email
            const email = (sess.user && (sess.user.email || sess.user.phone || sess.user.user_metadata?.email || sess.user.identities?.[0]?.identity_data?.email)) || '로그인됨';
            statusEl.textContent = email ? `로그인됨 · ${email}` : '로그인됨';
          } else {
            // Show Apple and Kakao buttons when not logged in
            if (appleBtn) appleBtn.style.display = 'inline-block';
            if (kakaoBtn) kakaoBtn.style.display = 'inline-block';
          }
          };
          // Initial UI update
          updateAuthUI();
          
          // Refresh session once after page load
          setTimeout(async () => {
            if (window.luweiAuth && window.luweiAuth.refreshSession) {
              await window.luweiAuth.refreshSession();
              updateAuthUI();
            }
          }, 1500);
          
          document.addEventListener('visibilitychange', updateAuthUI);
          
          // Also listen for storage changes (cross-tab sync)
          window.addEventListener('storage', updateAuthUI);
          
          // Listen for auth change events
          window.addEventListener('luwei:authChanged', updateAuthUI);
          const signWith = async (provider)=>{
            try{ await window.luweiAuth.oauthSignIn(provider); }catch(e){ alert(provider+' 로그인 실패'); }
          };
          box.querySelector('#auth_google').onclick = ()=> signWith('google');
          box.querySelector('#auth_kakao').onclick = ()=> signWith('kakao');
          box.querySelector('#auth_instagram').onclick = ()=> signWith('instagram');
          box.querySelector('#auth_apple').onclick = ()=> signWith('apple');
          outBtn.onclick = async ()=>{
            window.luweiAuth.signOut();
            // Clear UI immediately
            outBtn.style.display = 'none';
            statusEl.style.display = 'none';
            const kakaoBtn = box.querySelector('#auth_kakao');
            if (appleBtn) appleBtn.style.display = 'inline-block';
            if (kakaoBtn) kakaoBtn.style.display = 'inline-block';
            // Update after a delay to ensure localStorage is cleared
            setTimeout(() => {
              updateAuthUI();
              alert('로그아웃');
            }, 100);
          };
        })();
    </script>
    
    <!-- Register Service Worker -->
    <script>
        if('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js').then(() => {
                console.log('[SW] Service worker registered');
            }).catch(err => {
                console.log('[SW] Service worker registration failed:', err);
            });
        }
    </script>
</body>
</html>
